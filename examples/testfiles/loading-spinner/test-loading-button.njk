{% from "components/cards/cards.njk" import card as card %}
{% from "components/buttons/buttons.njk" import button as button %}


<main class="container page-container" id="main-content">
    <div class="row mb-905">
        <div class="col-12">
            <h1 class="h2 mt-0">Loading spinner</h1>
        </div>
    </div>
    <div class="row mb-905">
        <div class="col-12 mb-4">
            <h2 class="h3 mt-0">Forskellige typer af knapper med loading spinner</h2>
        </div>
        <div class="col-12 mb-4">
            <button id="test-1" class="button button-primary">
                <span>Gem</span>
            </button>
            <span id="test-1-message" aria-live="polite" class="sr-only"></span>
        </div>
        <div class="col-12 col-sm-4 mb-4">
            <button id="test-long-text" class="button button-secondary">
                <span>UmdolorsitametconsecteturadipiscingelitNullamutaugueeuismodhendreritarcusedbibendumsapienCrasegetlaciniatortorVivamusaliqu</span>
            </button>
            <span id="test-long-text-message" aria-live="polite" class="sr-only"></span>
        </div>
        <div class="col-12 mb-4">
            <button id="test-2" class="button button-icon-only">
                <svg class="icon-svg" focusable="false" aria-hidden="true"><use href="#save"></use></svg>
                <span class="sr-only">Gem</span>
            </button>
            <span id="test-2-message" aria-live="polite" class="sr-only"></span>
        </div>
    </div>
    <div class="row mb-905">
        <div class="col-12 mb-4">
            <h2 class="h3 mt-0">Loading spinner på tekst med 25% opacity</h2>
            <div class="position-relative" style="max-width: fit-content;">
                <p style="opacity: 0.25;"> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer vel tortor ultrices, viverra purus eget, varius lacus. Aliquam arcu lorem, pharetra at commodo ac, luctus vitae dui. Integer mollis est nec nisl consequat vestibulum. Maecenas lobortis, nisl vitae fringilla hendrerit, purus leo dignissim enim, vitae lacinia enim erat eu est. Nunc tempus cursus ultrices. Curabitur ut diam ante. Etiam augue dolor, volutpat vitae porta faucibus, pulvinar vel orci. Duis ullamcorper elementum odio, vitae feugiat odio. Vestibulum sodales a lectus sit amet venenatis. Nullam cursus quam at gravida aliquam. Suspendisse varius, dui id dapibus pharetra, eros lorem accumsan justo, eu venenatis urna est in neque. Vestibulum sit amet suscipit tellus. Fusce placerat lacus eget consequat tincidunt. Nam sapien diam, molestie sit amet nisi eget, varius aliquam magna. Pellentesque consequat tristique gravida. Aliquam in dictum ipsum. Cras dictum nisi vel orci dictum porta. Praesent eget ante laoreet, tempor lorem id, pulvinar arcu. Vivamus tellus libero, suscipit a nibh nec, ullamcorper viverra enim. Vivamus at posuere quam, non blandit augue. Quisque ullamcorper dui vitae vestibulum sollicitudin. Phasellus turpis ligula, convallis sit amet metus non, vestibulum sodales orci. Ut auctor sodales sapien in sagittis. Ut rhoncus eleifend arcu et dapibus. </p>
                <div class="align-text-center position-absolute" style="left: 35%; top: 35%;">
                    <div class="spinner"></div>
                    <div class="spinner-status" role="status">Henter indhold ...</div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-905">
        <div class="col-12 mb-4">
            <h2 class="h3 mt-0">Loading button forsvinder efter indlæsning</h2>
        </div>
        <div class="col-12 mb-4">
            <button id="load-more-button" class="button button-primary">
                <span>Se flere cards</span>
            </button>
            <span id="load-more-message" aria-live="polite" class="sr-only"></span>
        </div>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-none">
            {{ 
                card({
                    "content": '<ul class="nobullet-list"><li><a href="#">Link</a></li><li><a href="#" class="icon-link" target="_blank">Eksternt link<svg class="icon-svg" aria-label="(åbner i nyt vindue)" focusable="false"><use href="#open-in-new"></use></svg></a></li></ul>'
                }) 
            }}
        </div>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-none">
            {{ 
                card({
                    "content": '<ul class="nobullet-list"><li><a href="#">Link</a></li><li><a href="#" class="icon-link" target="_blank">Eksternt link<svg class="icon-svg" aria-label="(åbner i nyt vindue)" focusable="false"><use href="#open-in-new"></use></svg></a></li></ul>'
                }) 
            }}
        </div>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-none">
            {{ 
                card({
                    "content": '<ul class="nobullet-list"><li><a href="#">Link</a></li><li><a href="#" class="icon-link" target="_blank">Eksternt link<svg class="icon-svg" aria-label="(åbner i nyt vindue)" focusable="false"><use href="#open-in-new"></use></svg></a></li></ul>'
                }) 
            }}
        </div>
    </div>
</main>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        function getCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            return `${hours}:${minutes}:${seconds}`;
        }

        document.getElementById('test-1').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-active')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-active');
                this.querySelector('span').classList.add('text-hidden');
                this.setAttribute('aria-disabled', true);

                document.getElementById('test-1-message').textContent = 'Gemmer';

                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small', 'spinner-light');
                this.prepend(spinner);

                setTimeout(() => {
                    this.classList.remove('spinner-active');
                    this.querySelector('.spinner').remove();
                    this.querySelector('span').classList.remove('text-hidden');
                    this.removeAttribute('aria-disabled');
                    document.getElementById('test-1-message').textContent = 'Gemt ' + getCurrentTime();
                }, 4000);
            }
        });

        document.getElementById('test-long-text').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-active')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-active');
                this.querySelector('span').classList.add('text-hidden');
                this.setAttribute('aria-disabled', true);

                document.getElementById('test-long-text-message').textContent = 'Gemmer';

                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small');
                this.prepend(spinner);

                setTimeout(() => {
                    this.classList.remove('spinner-active');
                    this.querySelector('.spinner').remove();
                    this.querySelector('span').classList.remove('text-hidden');
                    this.removeAttribute('aria-disabled');
                    document.getElementById('test-long-text-message').textContent = 'Gemt ' + getCurrentTime();
                }, 4000);
            }
        });

        document.getElementById('test-2').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-active')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-active');
                this.querySelector('.icon-svg').classList.add('text-hidden');
                this.setAttribute('aria-disabled', true);

                document.getElementById('test-2-message').textContent = 'Gemmer';
                
                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small');
                this.prepend(spinner);

                setTimeout(() => {
                    this.classList.remove('spinner-active');
                    this.querySelector('.spinner').remove();
                    this.querySelector('.icon-svg').classList.remove('text-hidden');
                    this.removeAttribute('aria-disabled');
                    document.getElementById('test-2-message').textContent = 'Gemt ' + getCurrentTime();
                }, 4000);
            }
        });

        document.getElementById('load-more-button').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-active')) {
                e.preventDefault();
            }
            else {
                this.classList.add('spinner-active');
                this.querySelector('span').classList.add('text-hidden');
                this.setAttribute('aria-disabled', true);

                document.getElementById('load-more-message').textContent = 'Indlæser cards';

                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small', 'spinner-light');
                this.prepend(spinner);

                setTimeout(() => {
                    let hiddenElements = document.querySelectorAll('.col-12.d-none');
                    for (let i = 0; i < hiddenElements.length; i++) {
                        hiddenElements[i].classList.remove('d-none');
                    }
                    document.getElementById('load-more-message').textContent = 'Card 1-3 indlæst';
                    if (document.activeElement === this) {
                        document.getElementById('load-more-message').setAttribute('tabindex', -1);
                        document.getElementById('load-more-message').removeAttribute('aria-live');
                        document.getElementById('load-more-message').focus();
                    }
                    this.remove();
                }, 4000);
            }
        });
    });
</script>