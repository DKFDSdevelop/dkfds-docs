{% from "components/cards/cards.njk" import card as card %}
{% from "components/buttons/buttons.njk" import button as button %}


<main class="container page-container" id="main-content">
    <div class="row mb-905">
        <div class="col-12">
            <h1 class="h2 mt-0">Loading spinner på knapper</h1>
        </div>
    </div>
    <div class="row mb-905">
        <div class="col-12 mb-4">
            <h2 class="h3 mt-0">Ikke-synlig skærmlæserbesked, tekst fjernes fra knappen</h2>
        </div>
        <div class="col-12 mb-4">
            <button id="test-1" class="button button-primary">
                <span>Gem</span>
            </button>
            <span id="test-1-message" aria-live="polite" class="sr-only"></span>
        </div>
        <div class="col-12 mb-4">
            <button id="test-2" class="button button-icon-only">
                <svg class="icon-svg" focusable="false" aria-hidden="true"><use href="#save"></use></svg>
                <span class="sr-only">Gem</span>
            </button>
            <span id="test-2-message" aria-live="polite" class="sr-only"></span>
        </div>
    </div>
    <div class="row mb-905">
        <div class="col-12 mb-4">
            <h2 class="h3 mt-0">Synlig besked, tekst fjernes fra knappen</h2>
        </div>
        <div class="col-12 mb-4 d-flex align-items-center">
            <button id="test-3" class="button button-primary">
                <span>Gem</span>
            </button>
            <span id="test-3-message" aria-live="polite" class="ml-305 form-hint"></span>
        </div>
        <div class="col-12 mb-4 d-flex align-items-center">
            <button id="test-4" class="button button-icon-only">
                <svg class="icon-svg" focusable="false" aria-hidden="true"><use href="#save"></use></svg>
                <span class="sr-only">Gem</span>
            </button>
            <span id="test-4-message" aria-live="polite" class="ml-305 form-hint"></span>
        </div>
    </div>
    <div class="row mb-905">
        <div class="col-12 mb-4">
            <h2 class="h3 mt-0">Ikke-synlig skærmlæserbesked, tekst bliver på knappen</h2>
        </div>
        <div class="col-12 mb-4">
            <button id="test-7" class="button button-primary" style="padding-left: calc(16px + 1.2rem);padding-right: calc(16px + 1.2rem);">
                <span>Gem</span>
            </button>
            <span id="test-7-message" aria-live="polite" class="sr-only"></span>
        </div>
        <div class="col-12 mb-4">
            <button id="test-8" class="button button-secondary">
                <svg class="icon-svg" focusable="false" aria-hidden="true"><use href="#save"></use></svg>
                <span>Gem</span>
            </button>
            <span id="test-8-message" aria-live="polite" class="sr-only"></span>
        </div>
    </div>
    <div class="row mb-905">
        <div class="col-12 mb-4">
            <h2 class="h3 mt-0">Loading button forsvinder efter indlæsning</h2>
        </div>
        <div class="col-12 mb-4">
            <button id="load-more-button" class="button button-primary">
                <span>Se flere cards</span>
            </button>
            <span id="load-more-message" aria-live="polite" class="sr-only"></span>
        </div>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-none">
            {{ 
                card({
                    "content": '<ul class="nobullet-list"><li><a href="#">Link</a></li><li><a href="#" class="icon-link" target="_blank">Eksternt link<svg class="icon-svg" aria-label="(åbner i nyt vindue)" focusable="false"><use href="#open-in-new"></use></svg></a></li></ul>'
                }) 
            }}
        </div>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-none">
            {{ 
                card({
                    "content": '<ul class="nobullet-list"><li><a href="#">Link</a></li><li><a href="#" class="icon-link" target="_blank">Eksternt link<svg class="icon-svg" aria-label="(åbner i nyt vindue)" focusable="false"><use href="#open-in-new"></use></svg></a></li></ul>'
                }) 
            }}
        </div>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-none">
            {{ 
                card({
                    "content": '<ul class="nobullet-list"><li><a href="#">Link</a></li><li><a href="#" class="icon-link" target="_blank">Eksternt link<svg class="icon-svg" aria-label="(åbner i nyt vindue)" focusable="false"><use href="#open-in-new"></use></svg></a></li></ul>'
                }) 
            }}
        </div>
    </div>
</main>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        function getCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            return `${hours}:${minutes}:${seconds}`;
        }

        document.getElementById('test-1').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-active')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-active');
                this.querySelector('span').classList.add('text-hidden');
                this.setAttribute('aria-disabled', true);

                document.getElementById('test-1-message').textContent = 'Gemmer';

                let srOnly = document.createElement('span');
                srOnly.classList.add('sr-only');
                srOnly.textContent = 'Gem';
                this.prepend(srOnly);

                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small', 'spinner-light');
                this.prepend(spinner);

                setTimeout(() => {
                    this.classList.remove('spinner-active');
                    this.querySelector('.spinner').remove();
                    this.querySelector('.sr-only').remove();
                    this.querySelector('span').classList.remove('text-hidden');
                    this.removeAttribute('aria-disabled');
                    document.getElementById('test-1-message').textContent = 'Gemt ' + getCurrentTime();
                }, 4000);
            }
        });

        document.getElementById('test-2').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-active')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-active');
                this.querySelector('.icon-svg').classList.add('text-hidden');
                this.setAttribute('aria-disabled', true);

                document.getElementById('test-2-message').textContent = 'Gemmer';
                
                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small');
                this.prepend(spinner);

                setTimeout(() => {
                    this.classList.remove('spinner-active');
                    this.querySelector('.spinner').remove();
                    this.querySelector('.icon-svg').classList.remove('text-hidden');
                    this.removeAttribute('aria-disabled');
                    document.getElementById('test-2-message').textContent = 'Gemt ' + getCurrentTime();
                }, 4000);
            }
        });

        document.getElementById('test-3').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-active')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-active');
                this.querySelector('span').classList.add('text-hidden');
                this.setAttribute('aria-disabled', true);

                document.getElementById('test-3-message').textContent = 'Gemmer...';

                let srOnly = document.createElement('span');
                srOnly.classList.add('sr-only');
                srOnly.textContent = 'Gem';
                this.prepend(srOnly);

                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small', 'spinner-light');
                this.prepend(spinner);

                setTimeout(() => {
                    this.classList.remove('spinner-active');
                    this.querySelector('.spinner').remove();
                    this.querySelector('.sr-only').remove();
                    this.querySelector('span').classList.remove('text-hidden');
                    this.removeAttribute('aria-disabled');
                    document.getElementById('test-3-message').textContent = 'Gemt ' + getCurrentTime();
                }, 4000);
            }
        });

        document.getElementById('test-4').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-active')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-active');
                this.querySelector('.icon-svg').classList.add('text-hidden');
                this.setAttribute('aria-disabled', true);

                document.getElementById('test-4-message').textContent = 'Gemmer...';
                
                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small');
                this.prepend(spinner);

                setTimeout(() => {
                    this.classList.remove('spinner-active');
                    this.querySelector('.spinner').remove();
                    this.querySelector('.icon-svg').classList.remove('text-hidden');
                    this.removeAttribute('aria-disabled');
                    document.getElementById('test-4-message').textContent = 'Gemt';
                }, 10);
            }
        });

        document.getElementById('test-7').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-started')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-started');
                this.setAttribute('aria-disabled', true);
                this.removeAttribute('style');

                document.getElementById('test-7-message').textContent = 'Gemmer';

                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small', 'spinner-light', 'mr-305');
                this.prepend(spinner);

                setTimeout(() => {
                    this.classList.remove('spinner-started');
                    this.querySelector('.spinner').remove();
                    this.removeAttribute('aria-disabled');
                    this.setAttribute('style', 'padding-left: calc(16px + 1.2rem);padding-right: calc(16px + 1.2rem);');
                    document.getElementById('test-7-message').textContent = 'Gemt ' + getCurrentTime();
                }, 4000);
            }
        });

        document.getElementById('test-8').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-started')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-started');
                this.querySelector('.icon-svg').remove();
                this.setAttribute('aria-disabled', true);

                document.getElementById('test-8-message').textContent = 'Gemmer';
                
                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small', 'mr-305', 'ml-2');
                this.prepend(spinner);

                setTimeout(() => {
                    this.classList.remove('spinner-started');
                    this.querySelector('.spinner').remove();
                    this.removeAttribute('aria-disabled');
                    this.innerHTML = '<svg class="icon-svg" focusable="false" aria-hidden="true"><use href="#save"></use></svg><span>Gem</span>';
                    document.getElementById('test-8-message').textContent = 'Gemt ' + getCurrentTime();
                }, 4000);
            }
        });

        document.getElementById('load-more-button').addEventListener('click', function (e) {
            if (this.classList.contains('spinner-active')) {
                e.preventDefault();
                console.log('Prevented click');
            }
            else {
                this.classList.add('spinner-active');
                this.querySelector('span').classList.add('text-hidden');
                this.setAttribute('aria-disabled', true);

                document.getElementById('load-more-message').textContent = 'Indlæser cards';

                let srOnly = document.createElement('span');
                srOnly.classList.add('sr-only');
                srOnly.textContent = 'Se flere cards';
                this.prepend(srOnly);

                let spinner = document.createElement('span');
                spinner.classList.add('spinner', 'spinner-small', 'spinner-light');
                this.prepend(spinner);

                setTimeout(() => {
                    let hiddenElements = document.querySelectorAll('.col-12.d-none');
                    for (let i = 0; i < hiddenElements.length; i++) {
                        hiddenElements[i].classList.remove('d-none');
                    }
                    document.getElementById('load-more-message').textContent = 'Card 1-3 indlæst';
                    if (document.activeElement === this) {
                        document.getElementById('load-more-message').setAttribute('tabindex', -1);
                        document.getElementById('load-more-message').removeAttribute('aria-live');
                        document.getElementById('load-more-message').focus();
                    }
                    this.remove();
                }, 4000);
            }
        });
    });
</script>